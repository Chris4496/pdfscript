<!DOCTYPE html>
<html>
  <head>
    <title>Hello, World!</title>
    <!-- Include eel.js - note this file doesn't exist in the 'web' directory -->
    <script type="text/javascript" src="/eel.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css"
    />
  </head>
  <body>
    <!-- Header start -->
    <div class="level">
      <div class="level-left">
        <div class="level-item m-3">
          <button class="button is-link is-small is-light" onclick="goback()">
            Go Back
          </button>
        </div>
      </div>
      <div class="level-right">
        <div class="level-item">
          <h1 class="title m-3">Combine By Student</h1>
        </div>
      </div>
    </div>
    <script>
      eel.expose(goback);
      function goback() {
        window.location = "index.html";
      }
    </script>
    <!-- Header end -->
    <!-- Notification -->
    <div
      class="notification is-danger mx-6"
      style="display: none"
      id="com_noti"
    >
      <button
        class="delete"
        onclick="document.querySelector('#com_noti').style.display='none'"
      ></button>
      Pick a directory!
    </div>
    <div
      class="notification is-danger mx-6"
      style="display: none"
      id="csv_noti"
    >
      <button
        class="delete"
        onclick="document.querySelector('#csv_noti').style.display='none'"
      ></button>
      Pick a CSV file!
    </div>
    <div
      class="notification is-danger mx-6"
      style="display: none"
      id="nofile_noti"
    >
      <button
        class="delete"
        onclick="document.querySelector('#nofile_noti').style.display='none'"
      ></button>
      There's no files in the directory you picked!
    </div>
    <div
      class="notification is-danger mx-6"
      style="display: none"
      id="notsame_noti"
    >
      <button
        class="delete"
        onclick="document.querySelector('#notsame_noti').style.display='none'"
      ></button>
      The files don't have the same amount of pages
    </div>

    <script>
      eel.expose(show_noti);
      function show_noti(noti) {
        if (noti == "csv") {
          document.querySelector("#csv_noti").style.display = "block";
        }
        if (noti == "com") {
          document.querySelector("#com_noti").style.display = "block";
        }
        if (noti == "nofile") {
          document.querySelector("#nofile_noti").style.display = "block";
        }
        if (noti == "notsame") {
          document.querySelector("#notsame_noti").style.display = "block";
        }
      }
    </script>
    <!-- Notification end -->

    <div class="columns is-multiline is-centered">
      <!-- PDF file upload -->
      <div class="column is-full">
        <div class="file has-name is-centered" id="dir_select">
          <label class="file-label">
            <input
              class="file-input"
              name="resume"
              type="button"
              onclick="diroc()"
            />
            <span class="file-cta">
              <span class="file-label"> Pick a directory… </span>
            </span>
            <span class="file-name"> No directory picked </span>
          </label>
        </div>
      </div>
      <script>
        async function diroc() {
          filename = await eel.get_com_dir()();
          if (filename.length > 0) {
            console.log(filename);
            const fileName = document.querySelector("#dir_select .file-name");
            fileName.textContent = filename;
          }
        }
      </script>
      <!-- PDF file upload end -->

      <!-- CSV file upload -->
      <div class="column is-full" id="csv_select">
        <div class="file has-name is-centered">
          <label class="file-label">
            <input
              class="file-input"
              name="resume"
              type="button"
              onclick="csvoc()"
            />
            <span class="file-cta">
              <span class="file-label"> Pick a CSV file… </span>
            </span>
            <span class="file-name"> No file picked </span>
          </label>
        </div>
      </div>
      <script>
        async function csvoc() {
          filename = await eel.get_csv()();
          if (filename.length > 0) {
            console.log(filename);
            const fileName = document.querySelector("#csv_select .file-name");
            fileName.textContent = filename;
          }
        }
      </script>
      <!-- CSV file upload end -->
      <!-- CSV preview -->
      <div class="column is-full" id="csv_preview">
        <h4
          class="subtitle is-5 has-text-centered"
          style="white-space: pre-line"
        ></h4>
      </div>
      <script>
        eel.expose(show_csv_preview);
        function show_csv_preview(first3names, total) {
          document.querySelector(
            "#csv_preview h4"
          ).textContent = `Names: ${first3names[0]}, ${first3names[1]}, ${first3names[2]}...\n${total} names in total`;
        }
      </script>
      <!-- CSV preview end -->
      <!-- Select save path -->
      <div class="column is-full">
        <div class="file has-name is-centered" id="save_path_select">
          <label class="file-label">
            <input
              class="file-input"
              name="resume"
              type="button"
              onclick="pathoc()"
            />
            <span class="file-cta">
              <span class="file-label"> File save at: </span>
            </span>
            <span class="file-name"> No location picked </span>
          </label>
        </div>
      </div>
      <script>
        eel.expose(pathchange);
        function pathchange(dir) {
          document.querySelector("#save_path_select .file-name").textContent =
            dir;
        }

        async function pathoc() {
          filename = await eel.get_save_path()();
          if (filename.length > 0) {
            console.log(filename);
            const fileName = document.querySelector(
              "#save_path_select .file-name"
            );
            fileName.textContent = filename;
          }
        }
      </script>
      <!-- Select save path end -->

      <!-- student submit button -->
      <div class="column is-full" id="number_submit">
        <div class="has-text-centered">
          <button class="button is-success" onclick="eel.submit_CBS()">
            Submit
          </button>
        </div>
      </div>
      <!-- student sumit button end -->
    </div>
  </body>
</html>
